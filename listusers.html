<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>userslist</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
        integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <style>
            tr:nth-child(odd) {
        background-color: #F2F2F2;
      }
    td{ border: 1px solid #ccc;
        text-align: center;
        padding: 15px;
    }
    
    th { border: 1px solid #ccc;
        color: white;
        background-color: #C0C0C0;
        padding: 19px;
    }
    
    table {
        border: 1px  #ccc;
        margin: 3% auto 3%;
        border-collapse: collapse;
        border-radius: 3px solid;
        width:60%;
    }
    .admin-users{
        margin-left: 300px;
        margin-top: 80px;
    }
    
        </style>
</head>

<body>
    <header id="admin-header">
    </header>  
    <div class="admin-users">
        <input type="text " id="myInput" class="myInput" placeholder="search by name.." onkeyup="searchFun()"
            autocomplete="off">
    </div>
    <table>
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">mobilenumber</th>
                <th scope="col">email</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody id="content"></tbody>
    </table>
    <script>
        let tableData = [];
        const dbUserName = "apikey-v2-kf8ex4frj52lu2wwin72qqktpi3occ9bfv4p80vbr99";
        const dbPassword = "68fc5b9dc8c58071087abaecc44a5f29";
        const basicAuth = 'Basic ' + btoa(dbUserName + ':' + dbPassword);

        let url =
        "https://2fbcb9ec-d57d-431a-8d72-186d88ddf478-bluemix.cloudantnosqldb.appdomain.cloud/rechargeapp_users/_all_docs?include_docs=true";
        axios.get(url, { headers: { 'Authorization': basicAuth } }).then(res => {
        let data = res.data;
        tableData = data.rows;
        displayTable(tableData);
        console.log("Success");
        }).catch(err => {
        let errorMessage = err.response.data.errorMessage;
        console.log(errorMessage);
        console.log("Fail");
        alert("Error-" + errorMessage);
        });

        function displayTable(tableData) {
        let content = "";
        for (let taskObj of tableData) {
        content = content + `<tr>
            <td>${taskObj.doc.name}</td>
            <td>${taskObj.doc.mobilenumber}</td>
            <td>${taskObj.doc.email}</td>
            <td><button type='button' onclick="deleteFun('${taskObj.doc._id}','${taskObj.doc._rev}')">Delete</button>
            </td>
        </tr>`;
        document.querySelector("#content").innerHTML = content;
        }
        }
        function deleteFun(id, revId) {
            alert("Function Works");
            console.log(id, revId);
            const dbUserName = "apikey-v2-kf8ex4frj52lu2wwin72qqktpi3occ9bfv4p80vbr99";
            const dbPassword = "68fc5b9dc8c58071087abaecc44a5f29";
            const basicAuth = 'Basic ' + btoa(dbUserName + ':' + dbPassword);
            let url = "https://2fbcb9ec-d57d-431a-8d72-186d88ddf478-bluemix.cloudantnosqldb.appdomain.cloud/rechargeapp_users/" + id + "?rev=" + revId;
            axios.delete(url, { headers: { 'Authorization': basicAuth } }).then(res => {
                alert("Success");
                window.location.reload();
            }).catch(err => {
                let errorMessage = err.response.data.errorMessage;
                console.log(errorMessage);
                alert("Failed");
                alert("Error -" + errorMessage);
            });
        }
        function searchFun() {
            let searchInput = document.getElementById("myInput").value.toUpperCase();
            let myTable = document.getElementById("content");
            let tableRow = myTable.getElementsByTagName("tr");
            for (var i = 0; i < tableRow.length; i++) {
                let tableDatas = tableRow[i].getElementsByTagName("td")[0];
                if (tableDatas) {
                    let textValue = tableDatas.textContent || tableDatas.innerText;
                    if (textValue.toUpperCase().indexOf(searchInput) > -1) {
                        tableRow[i].style.display = "";

                    } else {
                        tableRow[i].style.display = "none";
                    }
                }


            }
        }

    </script>
    <script src="js/jquery.min.js"></script>
    <script>
        $("#admin-header").load("adminheader.html");

    </script>
</body>

</html>